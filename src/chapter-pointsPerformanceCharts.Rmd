---
output:
  html_document:
    keep_md: yes
---
```{r setup, echo = F, message=F}
library(knitr)
opts_chunk$set(fig.path = "images/pointsPerformance-")
```
# Points Performance Charts

Knowing the likely payoff for different grid positions in terms of the number of points a car starting in that position is likely to attain is one-way of putting points-and-positions data to work. Another way in which we can look at points data is to use it to compare the performance of two different drivers, such as two drivers in the same team.

In this chapter, we'll explore some preliminary sketches of *points performance charts*, a novel graphical technique for comparing not just driver performances. The charts are also intended to demonstrate the extent to which a team maximises its points haul when the lead driver attains a particular points scoring position, although in their current form they are not as successful as hoped for in demonstrating this: the charts are hard to interpret and don't clearly communicate how teams compare in their points haul efficiency - the race position comparison charts are as equally effective at revealing this, if not more so.

This approach is very much a work a progress whose usefulness - or otherwise - is yet to be proven. What it will demonstrate, nevertheless, is how we can construct our own graphical chart types as tools that help us probe our understanding of the data in novel ways.

The origins of the *points performance chart* begin with a question surrounding the extent to which teams maximise their points haul given the finishing position of their highest placed driver in each race. But first, let's quickly have a look at another points related chart: *grid points productivity*.

## Grid Points Productivity

Since the 2010 season, the top ten classified positions in each race are awarded an associated number of championship points depending on classified position (25 for first, 18 for second, 15 for third, then 12, 10, 8, 6, 4, 2 and finally 1 point for 10th) ([FIA F1 Regulations](http://www.fia.com/sport/regulations?f%5B0%5D=field_regulation_category%3A82)). A tweak to the 2014 regulations made double points available in the final race of the season of that year.

*Grid points productivity* describes the number of points a driver might be expected to earn from a given grid position. That is, for each grid position over a given period, find the mean number of points awarded.

```{r message=FALSE}
library(DBI)
library(plyr)

ergastdb =dbConnect(RSQLite::SQLite(), './ergastdb13.sqlite')

q='SELECT rs.grid, rs.points, rs.position, rs.grid-rs.position gridposdelta 
   FROM results rs JOIN races r
   WHERE rs.raceId=r.raceId AND r.year>=2010'

rr=dbGetQuery(ergastdb, q)

#Make a factor from the grid positions
rr['gr']=factor(rr$grid)

#Find the mean number of points associated with each grid position
rrp=ddply(rr,.(gr),summarise,m=mean(points))
```

Charting these shows how we might expect points to be awarded for a given grid position, *on average*:

```{r gridexpectpoints,fig.cap='Average number of points awarded per grid position',warning=FALSE,message=FALSE}
library(ggplot2)

g=ggplot(rrp[-1,],aes(x=gr,y=m,group=1))
g=g+geom_point()+stat_smooth(method = "lm", formula = y ~ x+I(x^2))
g + xlab('Grid position') + ylab('Expected number of points')
```

So for example, from first on the grid, we might expect a driver to earn 18 points, from second, 15 points, and so on.

We can also generate a chart that shows the mean *gridposdelta*, that is, the average number of places made (or lost) from a given grid position.

```{r gridposproductivity, fig.cap='Chart showing the number of positions you might expect to gain - or lose - form a given grid position'}
#Find the average displacement in terms of positions gained or lost from a given start
rrg=ddply(rr[!is.na(rr$position),], .(gr), summarise, m=mean(gridposdelta))

g=ggplot(rrg,aes(x=gr,y=m,group=1))+geom_point()
g=g+stat_smooth(method = "lm", formula = y ~ x+I(x^2))
g + xlab('Grid position') + ylab('Expected change in position')
```

From this chart, it looks as if cars starting from 8th or above on the grid are likely to lose a position, whereas cars starting 9th or lower look set to gain places, *on average*, with 2nd and 3rd being susceptible to most change at the front of the grid.

A complementary chart might plot the average final classification against the starting grid position:

```{r gridposav, fig.cap=''}
#Find the average final position for a given grid position
rrg=ddply(rr[!is.na(rr$position),], .(gr), summarise, f=mean(position))

g=ggplot(rrg,aes(x=gr,y=f,group=1))+geom_point()
g=g+stat_smooth(method = "lm", formula = y ~ x+I(x^2))
g + xlab('Grid position') + ylab('Expected final position')
```

Finally, we can generate a chart that shows the average points effect for each grid position of qualifying one place further down the grid.

```{r costofaplace, fig.cap='Charting the expected points cost of starting one place lower down the grid for a given grid position'}
#Find the running difference in the mean number of points from a given grid position
rrpdf=diff(rrp$m)
dfx=data.frame(i=1:length(rrpdf[-1]),d=rrpdf[-1])

g=ggplot(dfx,aes(x=i,y=d))+geom_point()
g=g+stat_smooth(method = "lm", formula = y ~ x+I(x^2))
g=g + xlab('Grid position')
g + ylab('Average points cost for starting one place lower down the grid')
```

In this chart, we see that starting in 3rd rather than 2nd would cost you more points than if you started in 2nd rather than 1st; similarly, going back from 3rd to 4th costs may not even cost you a point, on average, but starting in 6th rather than 5th is likely to cost you at least 2 points.

## Maximising Team Points Hauls

Championship points serve to provide continuity and an element of competition across a season, and are used to maintain audience interest even if the action on track is at times somewhat processional.

If a team's highest classified car finishes in the top 9 positions, the team will maximise its points haul if the other car is placed in the next position. If the highest placed car wins the race, scoring the maximum 25 points (unless it was the last race of the season in 2014, when double points were awarded), the team will obviously maximise its points haul if the other car is placed second. In fact, this is the ultimate points haul - *25 + 18 = 43* points for the team from a single race.

Let's start by grabbing some data, joining together two copies of the results table on `raceId`, `driverId` and `constructorId` with distinct `driverId`. We'll record the results of the higher-placed driver in the team (*r1*) and the lower placed driver (*r2*) in the same team from across several seasons. We'll also grab the total points haul for each team in each race.

```{r teamPointsPerRace,fig.cap='Points hauls per team for races 2010-2013',message=FALSE}
#Find results for pairs of drivers in the same team and the same race
#At least one driver must score points
#r1 is placed ahead of r2 in terms of points haul
results=dbGetQuery(ergastdb,
                   'SELECT  year, constructorRef AS team,
                            r1.position AS r1pos,
                            r2.position AS r2pos, 
                            r1.points AS r1points, 
                            r2.points AS r2points, 
                            (r1.points+r2.points) AS points 
                   FROM results r1 JOIN results r2 JOIN races r JOIN constructors c 
                   WHERE r1.raceId=r2.raceId 
                        AND r1.constructorId=r2.constructorId 
                        AND c.constructorId=r2.constructorId 
                        AND r.raceId=r1.raceId 
                        AND r1.driverId!=r2.driverId 
                        AND r1.points>r2.points 
                        AND year >=2010')
```

We can use a box plot to show the distribution of team points across a series of races where at least one team member was in the points, illustrating the extent to which teams maximised their points haul during each race.

```{r teamPerfBoxPlot,fig.cap="Box plot showing the distribution of the total team points scored by drivers, per team, in races from the 2010 to 2013 seasons inclusive, against the position of the highest placed driver in team",warning=FALSE,message=FALSE}
points=c(25,18,15,12,10,8,6,4,2,1)

pos.points=data.frame(position=seq(10),
                      points=points,
                      maximiser.points=c(points[-1],0),
                      max.pts=points+c(points[-1],0))
                
teamPerformance=function(results){
  g= ggplot(results,aes(x=factor(r1pos),y=points))
  g= g+ geom_boxplot(aes(group=r1pos)) 
  g= g+ geom_line(data=pos.points, aes(x=position, y=max.pts), colour='blue')
  g= g+ geom_line(data=pos.points, aes(x=position, y=points), colour='grey')
  g=g+stat_sum(aes(size = ..n..))
  g= g+ stat_smooth(aes(x=r1pos), colour='magenta',se=FALSE)
  g =g+ xlab('Position of highest placed driver in team')
  g= g + ylab('Total team points')
  g
}

g=teamPerformance(results)
g
```

The blue line shows the maximum points available; the magenta line is a fitted line on the distribution of total points received per ranking position of the highest (or only) placed driver in the team; the grey line shows the minimum points haul (that is, just the number of points scored by the highest placed driver). The filled circles are proportionally sized according to the number of times a particular team points haul was recorded given the position of the highest ranked team member. In this example, data comes from all teams for the seasons 2010-2013.

If each team maximised its points (given a particular classification for the lead driver) in every race, there would be a single large circle on the uppermost blue line for each finishing position.

In the boxplot itself, the horizontal bar depicts the *median* value of the total points scored by a team for each finishing position of the highest placed driver in the team. The box itself shows the range of the first to the third quartile and the lines extend out to the highest and lowest values that lie within 1.5 times the interquartile range. This all sounds very complicated, but basically it describes the distribution of the points scores and allows outliers to be highlighted specifically. (In this case, there are no outliers.)

A faceted chart allows us to summarise the ability of different teams to maximise their points hauls.

```{r teamPerfBoxPlot_facet,warning=FALSE,message=FALSE}
g+facet_wrap(~team)
```

The closeness of the magenta line to the blue line is an indicator of the extent to which the team members were keeping each other honest and the team was maximising its points haul. The closeness of the magenta line to the grey line is an indicator of the extent to which the points haul was solely down to the highest placed driver in each race.

If we limit the data to driver performances from a particular team, we can see how well that team fared over several years.

```{r teamPerfBoxPlotMcLaren,warning=FALSE,message=FALSE}
teamPerformance(results[results['team']=='mclaren',])+facet_wrap(~year)
```

This chart shows how, in 2011, McLaren lowest points scoring position was 4th. On the other hand, in 2013, the chart shows how McLaren missed out on the podium for the whole of the season.

But the following chart shows how Red Bull dominated that season even more convincingly:

```{r teamPerfBoxPlotRedBull,warning=FALSE,message=FALSE}
teamPerformance(results[results['team']=='red_bull',]) + facet_wrap(~year)
```

We can look at summary statistics of the distribution of total points scores more exactly by looking at some key values in a tabular format, in particular the mean and median number of points scored by the teams. The following table summarises results across all teams and all races for the 2010 to 2013 seasons inclusive.

```{r}
teamPerformance.table=function(results){
  teamPerformance =ddply(results,'r1pos',summarise,
                       mean_pts=mean(points), 
                       med_pts=median(points),
                       mean_r2pts=mean(r2points),
                       med_r2pts=median(r2points),
                       mean_r2pos=mean(r2pos,na.rm=TRUE),
                       med_r2pos=median(r2pos,na.rm=TRUE))
  teamPerformance['pts']=points
  teamPerformance['maxPts']=pos.points$max.pts
  teamPerformance['r2maxpts']=c(points[-1],0)
  teamPerformance
}
```
```{r echo=FALSE}
teamPerformance=teamPerformance.table(results)
kable(teamPerformance[,c('r1pos','maxPts','mean_pts','med_pts','pts','r2maxpts','med_r2pts','mean_r2pts')],digits=2,format='markdown')
```

From this table we can see how far teams in general tend to fall short in terms of their ability to maximise points given the position of their highest placed driver. The discrete nature of the number of points awarded suggests that the median points score may give a more useful indicator of the "central" behavior of the second placed car in the team than the real valued mean points score.

How are we then to read the table? Recall that the median value identifies the number of points for which the team score more points half of the time, and less points the other half of the time. The median points scored column thus suggests that when the lead driver in a team is placed first, their teammate will finish in the top 4, giving a combined team points haul of 37 points.

As well as comparing points, we can also compare the typical positions achieved by the second placed driver in a team. This shows rather more directly how close in support the second driver was to the first placed driver in the team.

```{r echo=FALSE}
kable(teamPerformance[,c('r1pos','med_r2pos','mean_r2pos')],digits=2,format='markdown')
```

Over the course of several seasons, we see that there must have been some rotation of teams on the podium: the median position for teammates of podium finishers was three places behind. Furthermore, if a driver finishes in the top 7, it's as likely as not that his team-mate will also finish in the top 10.

## Intra-Team Support

We can get a better idea of how the team mates supported each other by plotting their respective positions on a jittered scatter plot. In the plot on the left, each point relates to a result for a particular team.  In the plot on the right, the dots reflect the number of results with that points profile. The horizontal x-axis is the position of the higher classified driver, the vertical y-axis the classification of their lower placed team mate.

```{r driverComparison, fig.width=8,fig.height=4,fig.cap="Comparison of team mate classifications where at least one driver is in the points for the 2010 to 2013 seasons. The higher placed driver's points are recorded against the horizontal x-axis, the lower placed driver's against the vertical y-axis. ",message=FALSE}

library(gridExtra)

#ggplot2 linetypes: blank, solid, dashed, dotted, dotdash, longdash, twodash

teampoints.dualchart=function(results){
  g=ggplot(results,aes(x=r1points,y=r2points))
  g=g+stat_smooth(se=FALSE,
                  colour='blue',linetype='dashed')
  g=g+geom_line(data=pos.points,aes(x=points,y=maximiser.points),
                col='red',linetype='solid')
  g=g+geom_line(data=teamPerformance,aes(x=pts,y=med_r2pts),
                col='magenta',linetype='dotdash')
  g=g+xlab(NULL)+ylab(NULL)

  g1=g+geom_jitter()
  g2=g+stat_sum(aes(size = ..n..))
  grid.arrange( g1, g2, ncol=2,widths=c(1.1,1.32))
}

teampoints.dualchart(results)
```

To improve the clarity of the chart presented in a black and white/photocopied form, we can use linestyle as well as colour to distinguish the separate lines. In the above example, the solid red line is the upper bound on the points the lower classified driver within a team can score. The dashed blue line is a fit that models the typical points contribution made by the second placed driver compared to their higher placed teammate. The dot-dashed magenta line plots the median number of points scored by the lower placed driver.

The above chart shows the behaviour for all teams over the sample period, but it doesn't really allow us to compare anything with anything much, other than perhaps noting a tendency for drivers to well support each other *if* they both finish in the points.

If we limit the sample to just those situations where a team placed *both* its drivers in the points, we can get a clearer view of how many points a team might expect to earn if it places both drivers.

```{r driverComparisonBothPoints, fig.width=8,fig.height=4,fig.cap="Comparison of team mate classifications where both drivers are in the points for the 2010 to 2013 seasons. The higher placed driver's points are recorded against the horizontal x-axis, the lower placed driver's against the vertical y-axis.",message=FALSE}
teampoints.dualchart(results[results['r2points']>0,])
```

If you win, you expect your team mate to finish in the top 4. If you take third, it looks as if your team mate stands a good chance of being fourth or sixth. Does this tell us anything about race psychology?! The chart also shows how well teams do seem to maximise their points hauls.


## Points Performance Charts - One-Way

Trying to get a feel for how teams maximise points in general is one thing, but can we develop this chart style to produce an instrument that gives us a useful indication about how well a particular team is faring in terms of points maximisation?

A *one-way points performance chart* can be used to show how well drivers within a team are supporting each other (or by extension, how closely two drivers from different teams are competing).

The chart will plot counts of the number of races in which each combination of points finishes was attained. In the *one-way* chart, we aren't interested in which driver was higher placed. The chart will be annotated with a line that shows the maximum possible points haul, give the points take of the highest placed driver.

We'll use a clean design for the chart, with squared off axes, and set the grid lines to reflect the actual points scores that are possible.

```{r basechartAnnotated,fig.cap="The basis of the one-way points performance chart, with maximum points haul line indicated"}
NEWPOINTS =c(25,18,15,12,10,8,6,4,2,1)

#The newpoints dataframe has two columns
#The first column indicates points available, in order
#The second column is the maximum number of points the lower placed driver could score
newpoints=data.frame(x=c(NEWPOINTS,0),y=c(NEWPOINTS[-1],0,0))

baseplot_singleWay=function(g){
  g=g+geom_line(data=newpoints,aes(x=x,y=y),col='red',linetype='dotted')
  g=g+xlab('Highest placed driver points')+ylab('Lower placed driver points')
  g=g+scale_y_continuous(breaks = newpoints$x,minor_breaks=NULL) 
  g=g+scale_x_continuous(breaks = newpoints$x,minor_breaks=NULL)
  g=g+coord_fixed()
  g=g+guides(size=FALSE)+theme_bw()
  g
}

baseplot_singleWay(ggplot())
```

A> ### Line Guides
A> Line guides can be added to a chart to help split up the chart area and provide a cue that helps us read more sense into the placement of particular marks. I don't know to what extent the Red Arrows pilots use the explosive canopy cords (which various commentators suggest they are) to help them sight their formations, but I think I'd make use of the visual cues they provide...
A>
A> ![Red Arrows canopy view](images/red_arrows_canopy.jpg)
A>
A> *Canopy view from Red Arrows cockpit*

To generate our points position chart, we'll get the driver results for the drivers we want to compare and then annotate the chart with the higher and lower of the race positions and points scored by the drivers in each race. A flag is also set to identify whether or not the second listed driver was higher placed than the first.

```{r}
raceoff_d1d2 = function(d1,d2) {
  raceoff=merge(d1[,c('points','position','positionText','round')],
                d2[,c('points','position','positionText','round')],
                by='round')
  #Is the second listed driver higher placed than the first?
  raceoff$topd2=(raceoff$position.x>raceoff$position.y)

  #Hack final round points for the 2014 season
  raceoff[raceoff['round']==19,]$points.x=raceoff[raceoff['round']==19,]$points.x/2
  raceoff[raceoff['round']==19,]$points.y=raceoff[raceoff['round']==19,]$points.y/2
  #d1 refers to the higher placed driver
  #d2 refers to the lower placed driver
  raceoff=ddply(raceoff, .(round),transform,
                d1pos=max(position.x,position.y),
                d2pos=min(position.x,position.y),
                d1points=max(points.x,points.y),
                d2points=min(points.x,points.y))
}
```

We can now generate a "raceoff"" datatable from the race results of two drivers. As an example, let's see how the two McLaren drivers, Jenson Button and Kevin Magnussen, supported each other in the 2014 season.

```{r}
#We're going to use data from the live ergast API for these charts
source('ergastR-core.R')

button=driverResults.df('2014','button')
magnussen=driverResults.df('2014','kevin_magnussen')

#Generate the raceoff dataframe for two drivers
raceoff=raceoff_d1d2(button,magnussen)

#Summarise the counts of higher/lower points allocation combinations
raceoff.team.summary=ddply(raceoff,.(d1points,d2points),summarise,
                           cnt=length(round))
```

We can then plot this data onto our base chart, using a symbol size proportional to the count of how many races a particular points combination was received in, and further labelled with the same count value.

```{r pointsPerfChartSingleWay,fig.cap="One-way points performance chart showing the extent to which a team did, or did not, maximise its points haul given the classification of its highest placed driver",message=FALSE}
pointsPerformanceChart=function(raceoff,raceoff.team.summary,constructorRef){
  g = ggplot(raceoff.team.summary, aes(x=d1points, y=d2points))
  g = baseplot_singleWay(g)
  g = g + stat_smooth(data=raceoff, aes(x=d1points, y=d2points),
                      se=F,col='magenta')
  g = g + geom_point(aes(size=cnt), col='pink')
  g = g + geom_text(aes(label=cnt), size=2)
  g = g + scale_size_continuous(range=c(3,8))
  g = g + ggtitle(constructorRef)
  
  g
}

pointsPerformanceChart(raceoff, raceoff.team.summary,
                       'Team Points Performance Chart, McLaren, 2014')
```

The closer the magenta best fit line is to the dashed red maximum points haul line, the closer the team members were terms of points finishes within each race. In this example, we see that there were only three races in which both drivers finished in the points in consecutive places and thus maximised the team points haul.

There are two main weaknesses with this chart. Firstly, we don't know whether one driver in particular dominated the other. Secondly, we don't know how the points finishes evolved over the course of the season. We will address the first point in an extension to the idea of the points performance chart below, by considering a *two way* rather than a *one-way* chart. As for tracking the evolution of the points distribution over time, one approach might be to generate a sequence of charts and animate the construction of the chart across the races in a particular season.

## Points Performance Charts - Two-Way

To get round the problem of the one-way points performance chart's inability to distinguish which, if either, of the team's drivers was dominating the points haul, we can generate a two-way chart in which each axis represents the points taken in a particular race by a particular driver.

In this chart, we can plot two guides to indicate the maximum possible points haul within a team depending on which driver within the team is higher placed.

```{r pointsPerformanceChart-2way, fig.cap='Line guides on a two-way points performace chart. The upper (blue) dotted line shows the maximum points haul if Driver 1 (x-axis) was higher placed, the lower (red) dotted line the maximum points haul if Driver 2 (y-axis) was higher placed'}
baseplot_twoway=function(g,d1="Driver 1 Race points", d2="Driver 2 Race Points"){
  g=g+geom_line(data=newpoints,aes(x=x,y=y),col='red',linetype='dotted')
  g=g+geom_line(data=newpoints,aes(x=rev(y),y=rev(x)),col='blue',linetype='dotted')
  g=g+geom_abline(col='grey')
  g=g+scale_y_continuous(breaks = newpoints$x,minor_breaks=NULL) 
  g=g+scale_x_continuous(breaks = newpoints$x,minor_breaks=NULL)
  g=g+xlab(d1)+ylab(d2)
  g=g+coord_fixed()
  g=g+theme_bw()
  g=g+guides(size=FALSE)
  g
}

baseplot_twoway(ggplot())
```

The red dotted line shows the maximum points haul line if *Driver 1* on the x-axis was higher placed in a particular race; the blue dotted line shows the maximum points haul line if *Driver 2* on the y-axis was higher placed.

*A points scoring team maximises its points haul when points combination markers are placed on the dashed lines.*

We now need to generate a suitable summary dataset that counts the number of races where each particular combination of points was recorded.

```{r}
#Summary table counting how well each particular driver fares against the other
raceoff.summary=ddply(raceoff, .(points.x,points.y), summarise,
                      cnt=length(round))
```

This data can be overplotted onto the basic two-way points performance chart.

```{r}
pointsDualPerformanceChart=function(raceoff,raceoff.summary,title,d1,d2){
  g=ggplot(raceoff.summary,aes(x=points.x,y=points.y))
  g=baseplot_twoway(g,d1,d2)
  g=g+stat_smooth(data=raceoff,aes(x=d1points,y=d2points),se=F,col='magenta')
  g=g+geom_point(aes(size=cnt),col='pink')
  g=g+geom_text(aes(label=cnt),size=2)
  g=g+scale_size(range=c(2,6),name="Count")
  g=g+ggtitle(title)
  
  g
}
```

Once again, we use a proportionally sized symbol overplotted with a value to denote points combination counts and make use of a best fit or model line to highlight the general performance.

```{r dualPointsPerformanceChart,message=FALSE,fig.cap="Two Way Points Performance chart showing how well two drivers in the same team supported each other in terms of maximising team points haul"}
pointsDualPerformanceChart(raceoff,raceoff.summary,
                           "Driver Points Performance Chart, McLaren, 2014",'BUT','MAG')
```

In this case, we see that the results are typically placed *off the maximum points lines*, showing that points take is not being maximised; and the marks are placed in the *lower right quadrant below the red dashed line*, signifying that the driver on the horizontal x-axis (in this case, Jenson Button (BUT)) tended to score more points that Kevin Magnussen (MAG) whose points scores are represented on the vertical y-axis. 

If the marks tended to appear in the upper left quadrant above the blue dashed line, it would denote that the driver represented on the y-axis tended to outperform the driver represented on the x-axis.

Note that this chart does not require that drivers are members of the same team, only that they drove in the same races.

### Exploring the Behaviour of the Two-Way Points Performance Chart

The *points performance charts* are a novel chart type that use maximum points haul guide lines to help us read sense into the marks placed on them. As a new chart type, it makes sense to use some extreme case dummy data to see what the limiting cases look like.

Let's create a simple function to sketch a crude two-way points performance chart.

```{r}
twowayPointsPerfSketch=function(df){
  g=ggplot(df,aes(x=d1,y=d2))+stat_sum(aes(size = ..n..))
  g=g+geom_abline(col='grey')
  g=g+stat_smooth(se=F,colour='blue')
  g=g+geom_line(data=newpoints,aes(x=x,y=y),col='red',linetype='longdash')
  g=g+geom_line(data=newpoints,aes(x=y,y=x),col='blue',linetype='longdash')
  g + coord_fixed() +guides(size=FALSE)
  }
```

We'll now consider several extreme cases of points take. First, for *twenty* races, where one driver scores each position in the top 10 twice, beating his team mate, who maximises points below by taking the next position in each race.

```{r twowaySketch1,message=FALSE,fig.cap=""}
subpoints=c(NEWPOINTS[-1],0)
df=data.frame(d1=numeric(),d2=numeric())
for (i in seq(length(NEWPOINTS))) {
  df=rbind(df,data.frame(d1=NEWPOINTS[i],d2=subpoints[i]))
}
df=rbind(df,df)

twowayPointsPerfSketch(df)
```

In this case, all the points lie on a single points haul maximisation line. The best fit model line closely follows the points maximisation line.

Second, for *twenty* races, where each driver scores each position in the top 10 once, beating his team mate, who once again maximises points below.

```{r twowaySketch2,message=FALSE,fig.cap=""}
df=data.frame(d1=numeric(),d2=numeric())
for (i in seq(length(NEWPOINTS))) {
  df=rbind(df,
           data.frame(d1=NEWPOINTS[i],d2=subpoints[i]),
           data.frame(d1=subpoints[i],d2=NEWPOINTS[i]))
}

twowayPointsPerfSketch(df)
```

If we add in another best fit line, this time for a simple linear model, we can get a feel for how closely it tends towards the grey equal points line.

```{r twowaySketch3,message=FALSE,fig.cap=""}
twowayPointsPerfSketch(df)+stat_smooth(se=F,method='lm',colour='magenta')
```

Third, this time for just *ten* races, where points are maximised and drivers alternate in terms of who scores the most points.

```{r twowaySketch4,message=FALSE,fig.cap=""}
df=data.frame(d1=numeric(),d2=numeric())
for (i in seq(1,length(NEWPOINTS),2)) {
  df=rbind(df,
           data.frame(d1=NEWPOINTS[i],d2=subpoints[i]),
           data.frame(d1=subpoints[i+1],d2=NEWPOINTS[i+1]))
}

twowayPointsPerfSketch(df)+stat_smooth(se=F,method='lm',colour='magenta')
```

Once again, we see how the best fit lines stay *within* the inner bounds of the points maximisation lines. Generally, if the team is maximising points, the best fit line will be in this inner space in the two-way chart.

The effective misalignment of the axes - consecutively placed drivers score *different* numbers of points - suggests it might be more informative to try to offset or bring the axes into alignment somehow.

X> ### Exercise - Rank Performance Charts
X>
X> The non-linear point distribution (first place taking 25 points, second taking 18 points, and so on) as well as the limited number of points taking positions means that the points performance charts are only informative where the the highest placed driver finishes in ninth position or above (so that both drivers have a chance of scoring points.)
X>
X> To apply this style of chart to the whole field, rather than using points along the axes, we could plot a *rank performance chart* using *(1 + field size - rank)* of the drivers. Unclassified drivers should be given a value of 0.
X>
X> Create a function to plot rank performance charts, or modify the current functions to accept a paramter that allows either a rank performance chart, or a points performance chart to be plotted. Compare data from the same teams using the two approaches. Does the improved linearity of the rank performance chart make it easier to read? Does the improved resolution of the rank based chart - that is, it's ability to diaply information about all classified positions, not just points bearing ones - make the chart more informative?

## Summary
In this chapter, we looked at *grid position points productivity* to see how  many points a driver might expect to gain from any given starting position on the grid, before exploring the extent to which teams maximise their points hauls, both in general terms by summarising results across all teams and several seasons, and in more detailed way by considering the performance of a single team in a single season.

A *one way points performance chart* can be used to plot a count of team points hauls for a set of races against the points scored by the highest placed driver in the team in each race. A line guide shows the maximum points haul possible given the position of the highest placed driver. The *one way* chart *does not* identify which driver was the higher placed.

A *two way points performance chart* plots a count of points combinations given the (x,y) pairing of points scored by each driver across the specified races. The two way plot *does* identify which driver scored better across the races. In the two way plot, *two* line guides identify the maximum possible points haul in a given race given the number of points scored by the higher placed driver *and* which driver it was.

One problem with both one-way and two-way points performance charts is that they don't reveal which races were responsible for which points hauls, or whether the relative balance of driver superiority evolved over the course of a season.

Another significant issue arises from the eccentric alignment of points across the two axes - it would be cleaner if points maximisation loci fell on a single diagonal, for example.